<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{common/layouts/default_layout}"
	  layout:fragment="Main">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	<form  name="updateForm" th:object="${minwon}" enctype="multipart/form-data">
	<input name="postNo" th:value="${minwon.postNo}" type="hidden">
		<div class="mb-3">
			<label for="">제목</label>
			<input class="form-control" type="text" th:field="*{title}">
		</div>
		<div class="mb-3">
			<label for="roomNo">작성자</label>
			<input class="form-control" type="text" th:field="*{roomNo}" readonly/>
		</div>
		
		<div class="mb-3">
		<label for="category">카테고리</label>
		<select class="form-select" th:field="*{category}" >
			 <option value="" selected >카테고리를 선택하세요</option>
			 	<option th:each="category : ${categories}"
                    	th:text="${category.categoryType}" th:value="${category.categoryNo}">
             	</option>
		</select>
		</div>
		
		<div class="mb-3">
			<label for="visitsDate">방문날짜</label>
			<input type="datetime-local" class="form-control" name="visitsDate" th:value="${#dates.format(minwon.visitsDate, 'yyyy-MM-dd HH:mm')}">
		</div>
		<div class="mb-3">
			 <label for="formFile" class="form-label">첨부파일</label>
			 <input class="form-control" type="file" th:field="*{chumbuImage}">
		</div>
		<div class="mb-3">
  			<label for="content" class="form-label">내용</label>
  			<textarea class="form-control" id="exampleFormControlTextarea1" rows="3" th:field="*{content}"></textarea>
		</div>
		<div>
			<button type="button" id="updateBtn">수정</button>
		</div>
	</form>
	<script>
		$('#updateBtn').on('click', update);
		
		function update(e){
			let dateObj = getFormData();
			
			$.ajax('minwonUpdate',{
				type : 'post',
				data : dateObj
			})
			.done(result => {
				console.log(result);
			})
			.fail(err => console.log(err))
		}
		
		function getFormData(){ //폼 데이터를 객체 형태로 변환
			let formAry = $('form[name="updateForm"]').serializeArray();
			
			let formObj = {};
			$.each(formAry, function(idx, tag){
				console.log(idx, tag);
				console.log(tag.name + ' : ' + tag.value);
				
				formObj[tag.name] = tag.value;
			})
			console.clear();
			console.log(formObj)
			return formObj;
		}
	</script>
</body>
</html>