<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{common/layouts/default_layout}">

<head>
	<meta charset="UTF-8">
	<style>
		#bName {
			float: left;
			color: #000000;
			font-size: 20px;
			font-weight: bold;
		}

		.btnDiv {
			text-align: center;
		}

		.saveBtn {
			display: inline-block;
			background: #6CBEC7;
			color: rgb(56, 53, 53);
		}
	</style>

</head>

<body>
	<div layout:fragment="Main">

		<div>
			<br> <br>

			<!-- ê±´ë¬¼ëª… -->
			<p id="bName"></p>

			<br> <br>

			<!-- Toast UI - Grid -->
			<div id="grid" style="position: relative; z-index: 1;"></div>

			<br>

			<div class="btnDiv">
				<button class="btn btn-light saveBtn">ì €ì¥</button>
			</div>
			<br>
		</div>

		<script th:inline="javascript">

			// JavaScriptì—ì„œ Thymeleaf ë³€ìˆ˜ ì‚¬ìš©í•˜ê¸° //
			/* 1. <script th:inline="javascript">
			   2. Thymeleaf ë³€ìˆ˜ ì‚¬ìš© */
			// ê´€ë¦¬ë¹„ í•­ëª© ëª©ë¡.
			let gwanlibiItemList = /*[[${ gwanlibiItemList }]]*/'ê¸°ë³¸ê°’';

			// ê±´ë¬¼ ì •ë³´.
			let buildingInfo = /*[[${buildingInfo}]]*/'ê¸°ë³¸ê°’';
			let buildingId = buildingInfo.buildingId;

			// ê±´ë¬¼ ì´ë¦„ ì¶œë ¥.
			$('#bName').text(buildingInfo.buildingName);

			// TOAST UI //
			// async - await
			let grid;
			$(document).ready(() => {
				grid = gridLoad();
			});


			// Toast UI - Grid //
			// # reference : https://adjh54.tistory.com/95
			// # reference : https://park-duck.tistory.com/entry/javascript-1-Toast-UI-Grid-%EA%B8%B0%EC%B4%88API-%EC%82%AC%EC%9A%A9%EB%B2%95
			// 01. Grid ìƒì„±.
			// return void
			const gridLoad = () => {
				const Grid = tui.Grid;
				// 02. Grid theme ì„¤ì •. (clean, stripe, default)
				Grid.applyTheme('stripe');

				// 03. Toast UI Grid êµ¬ì„±.
				const grid = new Grid({
					// ================================== ê³µí†µ ì˜µì…˜ ì ìš© ================================== //
					el: document.getElementById('grid'), // í•„ìˆ˜ : Container element
					data: gwanlibiItemList,
					scrollX: false,
					scrollY: false,
					rowHeaders: ['rowNum'],
					// ================================== ì»¬ëŸ¼ ì˜µì…˜ ì ìš© ================================== //
					columns: [
						{
							header: 'ë²ˆí˜¸',
							name: 'gwanlibiItemNo',
							hidden: true
						},
						{
							header: 'ê±´ë¬¼ ë²ˆí˜¸',
							name: 'buildingId',
							hidden: true
						},
						{
							header: 'ê´€ë¦¬ë¹„ ë³€ë™ ì—¬ë¶€',
							name: 'variableYn',
							hidden: true
						},
						// [Column-1] ê´€ë¦¬ë¹„ í•­ëª©
						{
							header: 'ê´€ë¦¬ë¹„ í•­ëª©',
							name: 'gwanlibiName',
							resizable: true,
							sortable: true,
							align: 'center'
						},
						// [Column-2] ê´€ë¦¬ë¹„
						{
							header: 'ê´€ë¦¬ë¹„ ê¸ˆì•¡',
							name: 'fixedPrice',
							resizable: true,
							align: 'center',
							editor: 'text',
							validation: {
								dataType: 'number',
								required: true,
								min: 0
							}
						}
					]
				})
				//grid.validate();
				//console.log(grid.getData());

				// variableYnê°€ ê³ ì • ê°’ì´ë©´ í•´ë‹¹ ì…€ ì‚¬ìš© ë§‰ê¸°.
				grid.getData().forEach(ele => {
					console.log(ele.rowKey);
					if (ele.variableYn == 'ê³ ì •') {
						grid.disableCell(ele.rowKey, 'fixedPrice');
					}
				})


				// ê´€ë¦¬ë¹„ ì €ì¥ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
				console.log(grid.getData());
				$('.saveBtn').on('click', function () {

					if (!buildingId) return;

					$.ajax({
						url: `${ctxPath}/insertGwanlibi`,
						method: 'post',
						contentType: 'application/json',
						data: JSON.stringify(grid.getData())
					}).done(function (url) {
						Swal.fire({
							icon: "success",
							title: "ë“±ë¡ ì™„ë£Œ ğŸ˜Š"
						}).then((result) => {
							if (result.isConfirmed) {
								location.href = ctxPath + url;
							}
						})

					}).fail(function (err) {
						console.log(err);
						Swal.fire({
			    			  icon: "error",
			    			  title: "ë“±ë¡ ì‹¤íŒ¨ ğŸ˜¢",
			    			  text: "ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”."
		    			});
					});

				});

				return grid;
			}




		</script>
	</div>
</body>

</html>