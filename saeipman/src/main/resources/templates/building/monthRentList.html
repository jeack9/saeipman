<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{common/layouts/default_layout}">
<head>
<meta charset="UTF-8">
<title>title</title>
<style>
#updateFrom {
	display: flex;
	flex-wrap: wrap;
	align-items: center;
	gap: 5px;
}

#updateFrom>* {
	margin: 0 !important;
	padding: 8px 12px;
}

th, td {
	text-align: center;
	vertical-align: middle;
}
</style>
</head>
<body>
	<div layout:fragment="Main" class="container col-xl-10">
		
			<div class="row">
				<form name="chagngeForm">
					<h4 class="mb-4">월세 납부내역</h4>
					<div class="row p-2 mb-2">
						<div class="col-md-6" style="padding-left:0px;">
							<select class="form-select mb-6 col"
								aria-label="Default select example" id="option"
								name="buildingId">
								<option selected value="">건물 전체</option>
								<option th:each="list : ${buildingNameList}"
									th:value="${list.buildingId}"
									th:selected="${list.buildingId}==${page.buildingId}">[[${list.buildingName}]]</option>
							</select>
						</div>
						<div class="col">
							<input type="text" class="form-control" placeholder="방번호"
								id="roomNoSearch">
						</div>
						<div class="col">
							<button type="button" class="btn btn-info" id="roomSearchBtn">검색</button>
						</div>
					</div>
					<div class="radio-container mb-4">
						<div class="radio-group">
							<label><input type="radio" name="paymentState" value=""
								th:checked="${page.paymentState == null}"> 전체 내역</label> <label><input
								type="radio" name="paymentState" value="-1"
								th:checked="${page.paymentState == -1}"> 연체</label> <label><input
								type="radio" name="paymentState" value="0"
								th:checked="${page.paymentState == 0}"> 예정</label> <label><input
								type="radio" name="paymentState" value="1"
								th:checked="${page.paymentState == 1}"> 납부완료</label>
						</div>
					</div>

					<table class="table table-hover">
						<thead>
							<tr>
								<th>건물명</th>
								<th>호실</th>
								<th>납부상태</th>
								<th>입금자명</th>
								<th>임차인명</th>
								<th>납부금액/납부일</th>
								<th>실 납부금액/실 납부일</th>
								<th>연체 메시지</th>
							</tr>
						</thead>
						<tbody>
							<th:block th:each="list:${monthRentList}">
								<tr>
									<td>[[${list.buildingName}]]</td>
									<td>[[${list.roomNo}]]</td>
									<td th:if="${list.paymentState==-1}">연체</td>
									<td th:if="${list.paymentState==0}">예정</td>
									<td th:if="${list.paymentState==1}">납부완료</td>
									<td>[[${list.imchainName}]]</td>
									<td>[[${list.depositorName}]]</td>
									<td>[[${#numbers.formatInteger(list.mRent, 3, 'COMMA')}]]원<br>[[${#dates.format(list.paymentDate,'yyyy-MM-dd')}]]
									</td>
									<td>[[${#numbers.formatInteger(list.realPaymentMoney, 3,
										'COMMA')}]]원<br>[[${#dates.format(list.realPaymentDate,'yyyy-MM-dd')}]]
									</td>
									<td></td>
								</tr>
							</th:block>
						</tbody>
					</table>
					<div th:if="${page.total == 0}" style="text-align: center">
						<br>검색결과가 없습니다.
					</div>
					<!-- 페이징 -->
					<th:block th:if="${page.total!=0}">
						<nav aria-label="Page navigation example">
							<ul class="pagination justify-content-center">

								<li class="page-item" th:if="${page.startPage > 1}"><a
									class="page-link"
									th:href="@{/monthPaymentHistory(pageNum=${page.startPage - 1}, buildingId=${page.buildingId})}"
									aria-label="Previous"> <span aria-hidden="true">&laquo;</span>
								</a></li>

								<th:block th:with="start=${page.startPage}, end=${page.endPage}">
									<li class="page-item"
										th:each="pageButton : ${#numbers.sequence(start, end)}"><a
										class="page-link"
										th:href="@{/monthPaymentHistory(pageNum=${pageButton}, buildingId=${page.buildingId})}"
										th:text="${pageButton}"></a></li>
								</th:block>

								<li class="page-item" th:if="${page.next}"><a
									class="page-link"
									th:href="@{/monthPaymentHistory(pageNum=${page.endPage + 1}, buildingId=${page.buildingId})}"
									aria-label="Next"> <span aria-hidden="true">&raquo;</span>
								</a></li>
							</ul>
						</nav>
					</th:block>

				</form>
			
		</div>
		<script>
			$('#option').on(
					'change',
					function(e) {
						bid = e.target.value;
						location.href = ctxPath
								+ '/monthPaymentHistory?buildingId=' + bid;
					})

			$('#roomSearchBtn').on(
					'click',
					function(e) {

						let roomNo = $(e.target).parent().children().eq(0)
								.val();
						let bid = $('#option').val();

						location.href = ctxPath
								+ '/monthPaymentHistory?roomNo=' + roomNo
								+ '&buildingId=' + bid;
					})

			$('input[name="paymentState"]').on('change', function(e) {
				let paymentState = $(e.target).val(); // 선택된 paymentState 값 가져오기 (전체 선택 시 값은 "")

				let buildingId = $("select[name='buildingId']").val();

				// paymentState가 빈 문자열이면 전체 조회를 위해 URL에서 제외
				let url = `monthPaymentHistory?buildingId=${buildingId}`;
				if (paymentState !== "") {
					url += `&paymentState=${paymentState}`;
				}

				// 새로운 URL로 페이지 이동
				location.href = url;
			});
		</script>
	</div>
</body>
</html>