<div xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{common/layouts/login_layout}" layout:fragment="Main">

	<div class="container-xxl position-relative bg-white d-flex p-0">
		<div class="container-fluid">
			<div class="row h-100 align-items-center justify-content-center"
				style="min-height: 100vh;">
				<div class="col-12 col-sm-8 col-md-6 col-lg-5 col-xl-4">
					<div class="bg-light rounded p-4 p-sm-5 my-4 mx-3">
						<div
							class="d-flex align-items-center justify-content-between mb-3">
							<h3 class="text-primary">
								<i class="fa fa-hashtag me-1"></i>Saeipman
							</h3>
							<h3 style="font-size: 20px">비밀번호 찾기</h3>
						</div>


						<div class="form-floating mb-3">
							<input type="text" class="form-control" id="name"
								name="imdaeinName"> <label for="floatingInput">이름</label>
						</div>
						<div class="form-floating mb-4">
							<input type="text" class="form-control" name="text"
								id="imdaeinId"> <label for="floatingInput">아이디</label>
						</div>


						<div class="form-floating mb-3">
							<div class="d-flex form-floating">
								<input type="text" class="form-control" id="tel"> <label
									for="phone">전화번호</label>

								<button type="button" class="btn btn-primary" id="sendPhone"
									style="min-width: 90px;">인증요청</button>
							</div>


							<div class="form-floating mb-4">
								<div class="d-flex form-floating">
									<input type="tel" class="form-control" name="phoneCheck">
									<label for="">인증번호</label>
									<button type="button" class="btn btn-primary"
										onclick="verifyCode()" style="min-width: 90px;">인증하기</button>
								</div>
							</div>


							<div
								class="d-flex align-items-center justify-content-between mb-4">

								<button type="submit" class="btn btn-primary py-3 w-100 mb-4"
									id="checkBtn">비밀번호 찾기</button>

							</div>
							<p class="text-center mb-0">
								<a th:href="@{/all/login}">로그인하기</a>
							</p>
						</div>
					</div>
				</div>
			</div>
			<!-- Sign In End -->
		</div>
	</div>
</div>

<script>
//인증번호 발송
 $('#sendPhone').click(function(){
	 let phoneNum = $('#tel').val();
	 alert('인증번호 발송')
	 
	 $.ajax({
		 type: "POST",
		 url: ctxPath + "/all/sendSMS",
		 data: {
			 "phone" : phoneNum
		 },
		 success: function(data){
			 let checkNum = data
			 console.log(checkNum)
				 },
				 error : function(i){
					 console.log(i)
				 }
			 })
		 })
		 
		function verifyCode(){
 		 let phoneNum = $('#tel').val();
		 let inputCode = $('input[name="phoneCheck"]').val();
		 if(!inputCode || inputCode.trim() === ''){ //인증번호입력없이 확인하기를 눌렀을 경우
			 alert("인증번호를 입력해주세요");
		 	 return;
		 }
		 
		 //인증번호 확인 ajax 요청
		 $.ajax({
			 url: ctxPath + "/all/smsCheck",
			 type: "POST",
			 data: {
				 "inputCode": inputCode,
				 "phone" : phoneNum
			 },
			 success: function(isCodeCorrect){
				 if(isCodeCorrect){
					 alert("인증번호가 일치합니다.");
				 }else {
					 alert("인증번호가 일치하지 않습니다.")
					 $('input[name="phoneCheck"]').focus()
				 }
				
			 },
			 error: function(){
				 alert("확인 실패.")
			 }
				 
		 })

		 
		 //
}
		
	
</script>